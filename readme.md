# coolh

This project is an attempt at writing a compiler for the
[COOL](https://theory.stanford.edu/~aiken/software/cool/cool-manual.pdf) programming language,
written in Haskell.

It currently only implements a lexer for the language.

## Dependencies

- GHC 9.6.7 or newer;
- Cabal 3.0 or newer.

Additionally, you might need a UNIX-like system,
Bash, and diff in order to run the .sh scripts provided.

## Running the lexer

The lexer can be run in one of the following ways:

### Running the lexer for a single file

If you'd like to run the lexer for a single file,
the following command shall suffice:

```
cabal run coolh.cabal -- -- <inp_path> <out_path>
```

where `<inp_path>` is the path to the input file (including the file name itself) the lexer
tries to tokenise, and `<out_path>` is the path to the output file (including the file name itself)
the lexer should write its output to.

### Running the lexer for multiple files

If you'd like to run the lexer for more than just one input file,
the following project provides several scripts that help automate that:

- `run.sh` - calling `run.sh` runs the lexer for all files in some target directory
  and writes the output files in some output directory. Both of those directories
  can be specified inside of the script itself (via modifying the `target_dir`
  and `out_dir` variables). By default, the script expects that input files
  end in `.in`, which then gets pruned and replaced by `.out` in the name
  of the output file. For example,

  ```
  some_input_file.in  ~>  some_input_file.out
  ```

- `diff.sh` - calling `diff.sh` runs the UNIX command *diff* in order to
  pairwise compare two files with *the same name* in ideally *different directories*.
  One of those files should ideally be a file generated by executing `run.sh`,
  whereas the other file contains the expected lexer output for the given file.
  Similarly to `run.sh`, both the `coolh` output and expected output directories
  can be further specified inside of the script itself, via modifying the
  `out_dir` and `expected_out_dir` variables.

- `clean.sh` - calling `clean.sh` deletes all files inside of some directory,
  ideally the one that `coolh` uses to store its output files. That can me further
  modified inside of the script itself.

**Example usage:**

Assuming the following root project directory layout (or similar):

```
. (root)
├── app
├── clean.sh
├── coolh.cabal
├── debug
├── diff.sh
├── dist-newstyle
├── expected    --->   (this will be out expected output directory)
├── lib
├── out         --->   (this will be our output directory)
├── readme.md
├── run.sh
├── src
└── todo.txt    --->   (this will be our target/input directory)
```

Then each one of the scripts will contain the following variable definitions:

- `run.sh`:
  - `target_dir="./tests"` - where the lexer will try to read files from;
  - `out_dir="./out"` - where the lexer will write its output files.

- `diff.sh`:
  - `out_dir="./out"`;
  - `expected_out_dir="./expected"` - the files that store the expected output of the lexer.

- `clean.sh`:
  - `out_dir="./out"`.
